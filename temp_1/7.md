# MODULE 7: Table Calculations & LOD

---

## **Topic 25: Table Calculations (Basics)**

### **What are Table Calculations?**

**Table Calculation** = Transformation performed on **values already in the view** (after data is queried and aggregated)

**Key Concept:**
- **NOT** part of database query
- Operates on **viz level** (what you see)
- Computed after aggregation
- No raw data access

**Difference from Regular Calculations:**

| Regular Calculation | Table Calculation |
|---------------------|-------------------|
| Queries database | Works on viz results |
| Row-level or aggregate | Always on aggregated data |
| Part of SQL query | Post-query processing |
| `SUM([Sales])` | `WINDOW_SUM(SUM([Sales]))` |

---

### **Why Use Table Calculations?**

‚úÖ **Compare to other values in table**
- Running totals
- Percent of total
- Rank
- Moving averages

‚úÖ **Time-based analysis**
- Year-over-year growth
- Period comparisons
- Cumulative sums

‚úÖ **Statistical operations**
- Percentiles
- Standard deviation from mean

‚úÖ **Complex aggregations**
- Can't do in regular calcs
- Require context of entire view

---

### **Table Calculation Structure**

**Syntax Pattern:**
```
FUNCTION(Aggregated_Field)
```

**Example:**
```
WINDOW_SUM(SUM([Sales]))
         ‚Üë          ‚Üë
    Table Calc   Regular Agg
```

**Always operates on aggregated field!**

---

### **Quick Table Calculations** ‚≠ê **EASIEST WAY TO START**

**Built-in table calculations** accessible via right-click.

**How to apply:**
1. Right-click measure pill in view
2. **Quick Table Calculation** ‚Üí
3. Choose type

**Available options:**
- Running Total
- Difference
- Percent Difference
- Percent of Total
- Rank
- Percentile
- Moving Average
- YTD Total (Year To Date)
- Compound Growth Rate
- Year over Year Growth
- YTD Growth

---

### **Quick Table Calc Examples**

**1. Running Total**

Cumulative sum up to current mark.

**Example - Cumulative Sales:**
```
Month | Sales | Running Total
Jan   | 100   | 100
Feb   | 150   | 250  (100+150)
Mar   | 200   | 450  (100+150+200)
```

**Creates:** `RUNNING_SUM(SUM([Sales]))`

---

**2. Difference**

Change from previous value (absolute).

**Example - Month-over-Month Change:**
```
Month | Sales | Difference
Jan   | 100   | -
Feb   | 150   | +50
Mar   | 200   | +50
Apr   | 180   | -20
```

**Creates:** `SUM([Sales]) - LOOKUP(SUM([Sales]), -1)`

---

**3. Percent Difference**

Change from previous value (percentage).

**Example - % Change:**
```
Month | Sales | % Difference
Jan   | 100   | -
Feb   | 150   | +50%
Mar   | 200   | +33.3%
Apr   | 180   | -10%
```

**Creates:** `(SUM([Sales]) - LOOKUP(SUM([Sales]), -1)) / LOOKUP(SUM([Sales]), -1)`

---

**4. Percent of Total**

Percentage each value represents of total.

**Example - Category Contribution:**
```
Category   | Sales | % of Total
Furniture  | 300   | 30%
Technology | 500   | 50%
Supplies   | 200   | 20%
Total      | 1000  | 100%
```

**Creates:** `SUM([Sales]) / TOTAL(SUM([Sales]))`

---

**5. Rank**

Position in sorted order.

**Example - Top Sellers:**
```
Product | Sales | Rank
Desk    | 1000  | 1
Chair   | 800   | 2
Lamp    | 300   | 3
Pen     | 50    | 4
```

**Creates:** `RANK(SUM([Sales]))`

---

**6. Moving Average**

Average of current + previous N values.

**Example - 3-Month Moving Average:**
```
Month | Sales | MA(3)
Jan   | 100   | 100
Feb   | 150   | 125  (avg of Jan, Feb)
Mar   | 200   | 150  (avg of Jan, Feb, Mar)
Apr   | 180   | 177  (avg of Feb, Mar, Apr)
```

**Creates:** `WINDOW_AVG(SUM([Sales]), -2, 0)`
*-2 = two periods back, 0 = current*

---

### **Table Calculation "Compute Using"** ‚≠ê‚≠ê‚≠ê **CRITICAL CONCEPT!**

**"Compute Using"** = Direction/dimension table calc operates along

**This is THE MOST IMPORTANT concept for table calculations!**

**Access:**
1. Right-click measure with table calc
2. **Compute Using** ‚Üí
3. Choose direction

---

### **Compute Using Options**

**Table (across):**
- Compute across entire table
- Ignores dimension breaks
- One continuous calculation

**Table (down):**
- Compute down columns
- Ignores row breaks

**Table (across then down):**
- Compute left-to-right, then top-to-bottom
- Like reading a book

**Table (down then across):**
- Compute top-to-bottom, then left-to-right

**Pane (down):**
- Separate calculation per pane
- Restarts for each partition

**Pane (across):**
- Separate calculation horizontally per pane

**Cell:**
- Each cell independent
- Rarely used

**Specific Dimensions:**
- Compute along chosen dimension(s)
- Most control

---

### **Compute Using Visual Example**

**Data:**
```
        Q1   Q2   Q3   Q4
West    100  150  200  250
East    120  180  240  300
```

---

**Running Total - Compute Using: Table (across)**
```
        Q1   Q2   Q3   Q4
West    100  250  450  700
East    820  1000 1240 1540
                    ‚Üë
            Continues across ALL cells
```

---

**Running Total - Compute Using: Quarter (specific dimension)**
```
        Q1   Q2   Q3   Q4
West    100  150  200  250  ‚Üê Restarts per region
East    120  180  240  300  ‚Üê Independent
```

---

**Running Total - Compute Using: Table (down)**
```
        Q1   Q2   Q3   Q4
West    100  150  200  250
East    220  330  440  550
         ‚Üë
    Sums down columns
```

---

### **Addressing and Partitioning** ‚≠ê **Advanced Concept**

**Behind "Compute Using" are two concepts:**

**Partitioning:**
- Dimensions that **divide** the calculation
- Separate calculations per partition
- Like grouping

**Addressing:**
- Dimensions that **define direction** of calculation
- The path the calculation follows
- Like ordering

---

**Example:**

**View:** Region (Rows), Quarter (Columns), Sales

**Compute Using: Quarter**
- **Partition by:** Region (separate calc per region)
- **Addressing:** Quarter (direction within region)

**Result:** Running total across quarters, restarting for each region

---

**To edit manually:**
1. Right-click table calc measure
2. **Edit Table Calculation**
3. **Specific Dimensions** radio button
4. Check addressing dimensions
5. Unchecked = partitioning

---

### **Table Calculation Functions**

**Built-in functions for manual table calcs:**

#### **1. WINDOW Functions**

Operate on **window** (range) of rows.

**WINDOW_SUM()**
```
WINDOW_SUM(SUM([Sales]))
```
Sum across entire window (all rows in partition)

**WINDOW_SUM() with range:**
```
WINDOW_SUM(SUM([Sales]), -2, 0)
```
Sum from 2 rows back to current
- Negative = previous rows
- Positive = future rows
- 0 = current row

---

**WINDOW_AVG()**
```
WINDOW_AVG(SUM([Sales]), -6, 0)
```
Average of last 7 values (including current)
**7-period moving average**

---

**WINDOW_MIN() / WINDOW_MAX()**
```
WINDOW_MIN(SUM([Sales]))
WINDOW_MAX(SUM([Sales]))
```
Min/Max value in window

---

**WINDOW_MEDIAN()**
```
WINDOW_MEDIAN(SUM([Profit]))
```
Median value in window

---

**WINDOW_STDEV() / WINDOW_VAR()**
```
WINDOW_STDEV(SUM([Sales]))
```
Standard deviation of values in window

---

#### **2. RUNNING Functions**

Cumulative calculations from start to current.

**RUNNING_SUM()**
```
RUNNING_SUM(SUM([Sales]))
```
Cumulative sum from first row to current

---

**RUNNING_AVG()**
```
RUNNING_AVG(SUM([Sales]))
```
Average from first row to current (expanding average)

---

**RUNNING_MIN() / RUNNING_MAX()**
```
RUNNING_MIN(SUM([Sales]))
RUNNING_MAX(SUM([Sales]))
```
Min/Max from start to current

---

#### **3. LOOKUP Function** ‚≠ê **VERY IMPORTANT!**

**Get value from different row.**

**Syntax:**
```
LOOKUP(expression, offset)
```

**Offset:**
- **0** = Current row
- **-1** = Previous row
- **-2** = 2 rows back
- **+1** = Next row
- **+2** = 2 rows ahead

---

**Example - Previous Month's Sales:**
```
LOOKUP(SUM([Sales]), -1)
```

**Example - Month-over-Month Change:**
```
SUM([Sales]) - LOOKUP(SUM([Sales]), -1)
```

**Example - % Change:**
```
(SUM([Sales]) - LOOKUP(SUM([Sales]), -1)) 
/ LOOKUP(SUM([Sales]), -1)
```

---

**FIRST() and LAST() with LOOKUP:**

**FIRST()** = Offset to first row in partition
**LAST()** = Offset to last row in partition

**Example - Get first value:**
```
LOOKUP(SUM([Sales]), FIRST())
```

**Example - Get last value:**
```
LOOKUP(SUM([Sales]), LAST())
```

**Example - Compare to first:**
```
SUM([Sales]) / LOOKUP(SUM([Sales]), FIRST())
```
Shows growth index (1.0 = baseline, 1.5 = 50% growth)

---

#### **4. INDEX Function**

**Position of current row** in partition.

```
INDEX()
```

Returns: 1, 2, 3, 4... (row number)

**Use cases:**
- Conditional formatting based on position
- Top N highlighting
- Alternating colors

**Example - Highlight top 5:**
```
IF INDEX() <= 5 THEN "Top 5" ELSE "Other" END
```

---

#### **5. SIZE Function**

**Total number of rows** in partition.

```
SIZE()
```

Returns: Total count of rows

**Example - Show only if >10 rows:**
```
IF SIZE() > 10 THEN SUM([Sales]) ELSE NULL END
```

---

#### **6. RANK Functions**

**Position in sorted order.**

**RANK()**
```
RANK(SUM([Sales]))
```
Standard rank (1, 2, 2, 4 for ties)

**RANK_UNIQUE()**
```
RANK_UNIQUE(SUM([Sales]))
```
No ties (1, 2, 3, 4)

**RANK_MODIFIED()**
```
RANK_MODIFIED(SUM([Sales]))
```
Modified competition rank (1, 3, 3, 4)

**RANK_DENSE()**
```
RANK_DENSE(SUM([Sales]))
```
Dense rank (1, 2, 2, 3 - no gaps)

**RANK_PERCENTILE()**
```
RANK_PERCENTILE(SUM([Sales]))
```
Percentile rank (0.0 to 1.0)

---

**Rank Options:**

**Syntax:**
```
RANK(expression, ['asc' | 'desc'])
```

**'asc'** = Ascending (smallest = rank 1)
**'desc'** = Descending (largest = rank 1) [default]

---

#### **7. TOTAL Function**

**Grand total** of entire partition.

```
TOTAL(SUM([Sales]))
```

**Use for percent of total:**
```
SUM([Sales]) / TOTAL(SUM([Sales]))
```

---

### **Practical Table Calculation Examples**

**1. Year-over-Year Growth %**

```
(SUM([Sales]) - LOOKUP(SUM([Sales]), -1)) 
/ LOOKUP(SUM([Sales]), -1)
```
**Compute Using:** Year
**Format as:** Percentage

---

**2. Running Total with Restart**

```
RUNNING_SUM(SUM([Sales]))
```
**Compute Using:** Month
**Partition by:** Year
**Result:** Cumulative by year, restarts each January

---

**3. Moving Average (3-month)**

```
WINDOW_AVG(SUM([Sales]), -2, 0)
```
**Compute Using:** Month
**Result:** Average of current + 2 previous months

---

**4. Percent of Total by Category**

```
SUM([Sales]) / TOTAL(SUM([Sales]))
```
**Compute Using:** Pane (down)
**Partition by:** Category
**Result:** Each product's % within its category

---

**5. Index for Conditional Format**

```
IF INDEX() = 1 THEN "First"
ELSEIF INDEX() = SIZE() THEN "Last"
ELSE "Middle"
END
```
**Drag to Color** for different formatting

---

**6. Rank with Top 10 Filter**

```
RANK(SUM([Sales]))
```
Then filter: `RANK <= 10`
**Result:** Shows only top 10 products

---

**7. Same Period Last Year**

```
LOOKUP(SUM([Sales]), -12)
```
**Compute Using:** Month (continuous)
**Result:** Sales from 12 months ago

---

**8. Contribution to Total**

```
SUM([Sales]) / WINDOW_SUM(SUM([Sales]))
```
**Compute Using:** Table (across)
**Format as:** Percentage

---

**9. Difference from Average**

```
SUM([Sales]) - WINDOW_AVG(SUM([Sales]))
```
**Compute Using:** Category
**Result:** How much each deviates from mean

---

**10. Cumulative Percent of Total**

```
RUNNING_SUM(SUM([Sales])) 
/ TOTAL(SUM([Sales]))
```
**Use for:** Pareto charts (80/20 rule)

---

### **Table Calculation Best Practices**

‚úÖ **DO:**
- Start with Quick Table Calculations
- Understand "Compute Using" thoroughly
- Test with small data first
- Use descriptive names for custom calcs
- Document complex table calcs

‚ùå **DON'T:**
- Nest table calcs excessively
- Mix with regular aggregations carelessly
- Forget to set compute direction
- Use when regular calc would work

---

### **Troubleshooting Table Calculations**

**Problem: "Getting wrong results"**
- **Solution:** Check "Compute Using" direction
- Most common issue!

**Problem: "Null values appearing"**
- **Solution:** LOOKUP offset goes outside partition
- Use NULL handling: `IFNULL(LOOKUP(...), 0)`

**Problem: "Table calc won't work"**
- **Solution:** Need aggregated measure
- Can't use on dimensions directly

**Problem: "Can't filter on table calc"**
- **Solution:** Calculated after filters
- See Topic 28 (Order of Operations)

---

### **Scenario-Based Questions:**

**Q1:** Show cumulative sales by month, restarting each year. Which compute using?
- A) Table (across)
- B) Month (addressing), Year (partitioning) ‚úÖ
- C) Year (addressing), Month (partitioning)
- D) Table (down)

**Why?** Need to calculate along months but partition by year so it restarts annually.

---

**Q2:** Calculate 3-month moving average. Which function?
- A) `RUNNING_AVG(SUM([Sales]))`
- B) `WINDOW_AVG(SUM([Sales]), -2, 0)` ‚úÖ
- C) `AVG(SUM([Sales]))`
- D) `TOTAL(AVG([Sales]))`

**Why?** WINDOW_AVG with -2 (two back) to 0 (current) = 3 values.

---

**Q3:** Show each product's percent of category total. Compute using?
- A) Table (across)
- B) Product
- C) Category ‚úÖ
- D) Table (down)

**Why?** Want to partition by category (separate calculation per category), address along products.

---

**Q4:** This calculation returns NULL: `LOOKUP(SUM([Sales]), -1)` for January. Why?
- A) Wrong syntax
- B) No previous month (offset goes out of range) ‚úÖ
- C) Wrong compute direction
- D) Need WINDOW_SUM

**Why?** January is first month, no previous (-1) value exists. Fix: `IFNULL(LOOKUP(SUM([Sales]), -1), 0)`

---

## **Topic 26: Quick Table Calculations**

### **Deep Dive into Each Quick Table Calc**

We covered basics; now let's master each one.

---

### **Running Total** ‚≠ê

**What it does:** Cumulative sum from start to current

**Formula created:**
```
RUNNING_SUM(SUM([Measure]))
```

**Common uses:**
- Cumulative sales over time
- Total customers acquired to date
- Budget burn (spent to date)

---

**Variations:**

**Restart at dimension break:**
```
Compute Using: Month
Partitioning: Year
Result: Resets each January
```

**Reverse running total:**
```
Compute Using: Table (across)
Restarting every: None
Direction: From last to first
```
Counts DOWN from total

---

**Practical Example:**

**View:** Month on Columns, Sales on Rows
**Apply:** Running Total
**Compute Using:** Month

```
Jan  Feb  Mar  Apr  May  Jun
100  250  450  650  900  1150
 ‚Üë    ‚Üë    ‚Üë
100  150  200  (actual monthly sales)
```

---

### **Difference (Absolute)**

**What it does:** Current value minus previous value

**Formula created:**
```
SUM([Measure]) - LOOKUP(SUM([Measure]), -1)
```

**Common uses:**
- Month-over-month change
- Daily increase/decrease
- Sequential variance

---

**Options:**

**Difference From:**
- Previous (default) - Compare to prior
- First - Compare all to first value
- Specific value - Compare to chosen reference

---

**Practical Example:**

**View:** Quarter on Rows, Sales on Rows
**Apply:** Difference
**Compute Using:** Quarter

```
Quarter | Sales | Difference
Q1      | 1000  | -
Q2      | 1200  | +200
Q3      | 1150  | -50
Q4      | 1400  | +250
```

Shows actual change in dollars.

---

### **Percent Difference**

**What it does:** Percentage change from previous

**Formula created:**
```
(SUM([Measure]) - LOOKUP(SUM([Measure]), -1)) 
/ LOOKUP(SUM([Measure]), -1)
```

**Common uses:**
- Growth rates
- % increase/decrease
- Period comparisons

---

**Remember to format as Percentage!**
- Right-click field ‚Üí Format ‚Üí Percentage

---

**Practical Example:**

```
Quarter | Sales | % Difference
Q1      | 1000  | -
Q2      | 1200  | +20%
Q3      | 1150  | -4.17%
Q4      | 1400  | +21.74%
```

Better than absolute for comparing proportional growth.

---

### **Percent of Total** ‚≠ê‚≠ê

**What it does:** Each value as % of grand total

**Formula created:**
```
SUM([Measure]) / TOTAL(SUM([Measure]))
```

**Common uses:**
- Market share
- Category contribution
- Portfolio allocation

---

**Compute Using options affect denominator:**

**Table (across):**
- % of entire table total

**Pane (down):**
- % of subtotal (within partition)

---

**Practical Example:**

**View:** Category on Rows, Sales on Rows
**Apply:** Percent of Total
**Compute Using:** Table (down)

```
Category    | Sales | % of Total
Furniture   | 3000  | 30%
Technology  | 5000  | 50%
Supplies    | 2000  | 20%
Total       | 10000 | 100%
```

---

**Two-Dimensional Percent of Total:**

**View:** Region (Rows), Category (Columns), Sales

**Compute Using: Pane (down)**
```
         Furniture  Technology  Supplies
West     40%        30%         30%       ‚Üê % within West
East     35%        45%        20%       ‚Üê % within East
```
Each region sums to 100%

**Compute Using: Table (across)**
```
         Furniture  Technology  Supplies
West     25%        15%         20%
East     15%        30%         20%
                    ‚Üë
            All cells sum to 100%
```

---

### **Rank** ‚≠ê‚≠ê

**What it does:** Position in sorted order

**Formula created:**
```
RANK(SUM([Measure]))
```

**Common uses:**
- Top performers
- Leaderboards
- Competitive analysis

---

**Rank Types:**

**Competition Rank (default):**
- Ties get same rank
- Next rank skips
- Example: 1, 2, 2, 4

**Dense Rank:**
- Ties get same rank
- Next rank doesn't skip
- Example: 1, 2, 2, 3

**Unique Rank:**
- No ties
- Breaks ties arbitrarily
- Example: 1, 2, 3, 4

---

**Ascending vs Descending:**

**Descending (default):**
- Largest value = Rank 1
- For sales, revenue, etc.

**Ascending:**
- Smallest value = Rank 1
- For costs, errors, defects

---

**Filtering with Rank:**

**Show Top 10:**
1. Apply Rank table calculation
2. Drag Rank to Filters
3. Filter: `Rank <= 10`

**‚ö†Ô∏è Important:** Rank calculates AFTER dimension filters but BEFORE table calc filters!

---

**Practical Example:**

```
Product  | Sales | Rank
Desk     | 5000  | 1
Chair    | 4500  | 2
Bookcase | 3000  | 3
Table    | 2500  | 4
Lamp     | 1000  | 5
```

Then filter Rank <= 3 to show top 3.

---

### **Percentile** ‚≠ê

**What it does:** Rank as percentage (0-100 or 0-1)

**Formula created:**
```
RANK_PERCENTILE(SUM([Measure]))
```

**Returns:** 0.0 to 1.0 (or 0% to 100% if formatted)

**Common uses:**
- Relative performance
- Benchmark positioning
- Distribution analysis

---

**Interpretation:**

**Percentile = 0.95 (95th percentile)**
- Better than 95% of values
- Top 5%

**Percentile = 0.50 (50th percentile)**
- Median
- Better than half

**Percentile = 0.25 (25th percentile)**
- Bottom quartile

---

**Practical Example:**

```
Student | Score | Percentile
Alice   | 98    | 100% (best)
Bob     | 85    | 75%
Carol   | 70    | 50%
Dave    | 60    | 25%
Eve     | 45    | 0% (worst)
```

---

### **Moving Average** ‚≠ê‚≠ê

**What it does:** Average of current + N surrounding values

**Formula created:**
```
WINDOW_AVG(SUM([Measure]), -N, 0)
```

**Common uses:**
- Smooth noisy data
- Identify trends
- Remove seasonality
- Stock analysis

---

**Options:**

**Number of periods:**
- 3-period: -2 to 0
- 7-period: -6 to 0
- Centered (5-period): -2 to +2

**Forward/backward:**
- Backward (default): Past + current
- Centered: Past + current + future
- Forward: Current + future (rare)

---

**Practical Example - Sales Smoothing:**

```
Month | Actual | MA(3)
Jan   | 100    | 100   (only 1 value)
Feb   | 200    | 150   ((100+200)/2)
Mar   | 150    | 150   ((100+200+150)/3)
Apr   | 300    | 217   ((200+150+300)/3)
May   | 250    | 233   ((150+300+250)/3)
```

Smooths out spikes, shows underlying trend.

---

**Choosing N:**

**Smaller N (3-5):**
- More responsive
- Shows recent changes
- Still somewhat noisy

**Larger N (7-12):**
- Smoother trend
- Less responsive
- Lags more

**Rule of thumb:** 
- Daily data: 7-day MA
- Monthly data: 3-4 month MA
- Seasonal: Use season length (12 for monthly)

---

### **YTD Total (Year To Date)** ‚≠ê

**What it does:** Running total from year start to current

**Formula created:**
```
RUNNING_SUM(SUM([Measure]))
```
With automatic partitioning by year

**Common uses:**
- Financial reporting
- Budget tracking
- Annual goals

---

**How it works:**

Tableau automatically:
1. Identifies date field
2. Partitions by year
3. Calculates running sum within year
4. Restarts each January

---

**Practical Example:**

```
Date      | Sales | YTD Total
Jan 2024  | 100   | 100
Feb 2024  | 150   | 250
Mar 2024  | 200   | 450
...
Dec 2024  | 180   | 5000
Jan 2025  | 120   | 120    ‚Üê Restarts
Feb 2025  | 140   | 260
```

---

### **Compound Growth Rate** ‚≠ê

**What it does:** CAGR from first to current period

**Formula created:**
```
(ZN(SUM([Measure])) / LOOKUP(ZN(SUM([Measure])), FIRST()))
^ (1 / INDEX()) - 1
```

**Common uses:**
- Investment returns
- Long-term growth
- Multi-year trends

---

**Interpretation:**

**CAGR = 15%**
- Average annual growth of 15%
- Smooths year-to-year volatility

---

### **Year over Year Growth** ‚≠ê‚≠ê

**What it does:** % change from same period last year

**Formula created:**
```
(ZN(SUM([Measure])) - LOOKUP(ZN(SUM([Measure])), -12))
/ ABS(LOOKUP(ZN(SUM([Measure])), -12))
```

**Assumes:** Monthly data (-12 = 12 months back)

**Common uses:**
- Seasonal businesses
- Annual comparisons
- Remove seasonality

---

**Practical Example:**

```
Month     | Sales | YoY Growth
Jan 2024  | 1000  | -
Feb 2024  | 1100  | -
...
Jan 2025  | 1200  | +20%  (vs Jan 2024)
Feb 2025  | 1250  | +13.6% (vs Feb 2024)
```

Compares same months across years.

---

### **YTD Growth** ‚≠ê

**What it does:** % change in YTD total vs last year's YTD

**Formula created:**
Combination of YTD total + YoY comparison

**Common uses:**
- Executive dashboards
- Financial reporting
- Goal tracking

---

**Practical Example:**

```
          2024 YTD  | 2025 YTD | YTD Growth
Jan       1000      | 1200     | +20%
Feb       2100      | 2450     | +16.7%
Mar       3300      | 3800     | +15.2%
```

Shows if you're outpacing last year cumulatively.

---

### **Custom Table Calculations**

**When Quick Table Calcs aren't enough:**

**Creating custom table calc:**
1. Analysis ‚Üí Create Calculated Field
2. Use table calc functions
3. Tableau recognizes automatically

**Example - Last Year Same Month:**
```
LOOKUP(SUM([Sales]), -12)
```

**Example - % of Max:**
```
SUM([Sales]) / WINDOW_MAX(SUM([Sales]))
```

**Example - Days Since Last Order:**
```
DATEDIFF('day', LOOKUP(MAX([Order Date]), -1), MAX([Order Date]))
```

---

### **Combining Table Calculations**

**You can nest table calcs carefully:**

**Example - Moving Average of Growth Rate:**
```
WINDOW_AVG(
  (SUM([Sales]) - LOOKUP(SUM([Sales]), -1)) 
  / LOOKUP(SUM([Sales]), -1),
  -2, 0
)
```

First calculates % change, then smooths with MA.

**‚ö†Ô∏è Warning:** Complex nested table calcs hard to debug!

---

### **Scenario-Based Questions:**

**Q1:** Show each product's % of total sales within its category. Which quick table calc and compute using?
- A) Percent of Total, Table (across)
- B) Percent of Total, Pane (down) where pane = category ‚úÖ
- C) Rank, Category
- D) Running Total, Product

**Why?** Percent of Total with pane scope partitions by category, so each category totals 100%.

---

**Q2:** You want 7-day moving average. Which function?
- A) `RUNNING_AVG(SUM([Sales]))`
- B) `WINDOW_AVG(SUM([Sales]), -6, 0)` ‚úÖ
- C) `WINDOW_AVG(SUM([Sales]), -7, 0)`
- D) `AVG(SUM([Sales]))`

**Why?** -6 to 0 = 7 values (6 previous + current). Note: -7 would be 8 values!

---

**Q3:** Filter to show top 10 customers by sales. Best approach?
- A) Dimension filter: Top 10
- B) Rank table calc, then filter Rank <= 10 ‚úÖ
- C) Percent of Total >= 0.10
- D) RUNNING_SUM table calc

**Why?** Rank table calc creates rank field that can be filtered. Top N dimension filter also works but table calc more flexible.

---

## **Practice Exercises:**

**Exercise 1: Running Total**
1. Create monthly sales line chart
2. Apply Running Total
3. Compute Using: Month
4. Add reference line showing goal

**Exercise 2: Moving Average**
1. Same monthly sales
2. Duplicate measure to dual axis
3. One showing actual (bars)
4. One showing 3-month MA (line)

**Exercise 3: Percent of Total (Continued)**
1. Create sales by Category and Region
2. Apply Percent of Total
3. Try different compute using:
   - Table: All cells % of grand total
   - Pane (down): Each region's categories = 100%
   - Pane (across): Each category's regions = 100%
4. Observe how results change!

**Exercise 4: Rank with Top N**
1. Create sales by Product bar chart
2. Apply Rank (descending)
3. Drag Rank to Filters
4. Filter: Rank <= 5
5. Add Rank to Label

**Exercise 5: Year over Year**
1. Create monthly sales over 2+ years
2. Apply Year over Year Growth
3. Format as percentage
4. Add color: Green (positive), Red (negative)

**Exercise 6: Compound Growth**
1. Create annual sales trend
2. Apply Compound Growth Rate
3. Compare to simple Year over Year
4. Which better shows long-term trend?

---

## **Topic 27: Level of Detail (LOD) Expressions** ‚≠ê‚≠ê‚≠ê **MOST ADVANCED & POWERFUL!**

### **What are LOD Expressions?**

**Level of Detail (LOD) Expression** = Calculation performed at a **specific granularity**, independent of view dimensions

**Revolutionary concept in Tableau!**

**Key Power:**
- Control aggregation level explicitly
- Calculate at different granularity than view
- Access row-level data from aggregated view
- Solve complex analytical problems

---

### **Why LOD Expressions?**

**Problems they solve:**

‚ùå **Problem 1:** "Show average sales per customer, but view shows products"
- Regular calc can't access customer level from product view
- ‚úÖ LOD can!

‚ùå **Problem 2:** "Show sales rank, but rank should ignore filters"
- Table calcs affected by filters
- ‚úÖ LOD calculated before most filters!

‚ùå **Problem 3:** "Calculate customer lifetime value at customer level, display at region level"
- Need two different granularities
- ‚úÖ LOD handles this!

---

### **LOD Expression Syntax**

**Basic structure:**
```
{ [FIXED | INCLUDE | EXCLUDE] dimension : aggregation }
```

**Three types:**
1. **FIXED** - Specific dimensions, ignore view
2. **INCLUDE** - View dimensions PLUS specified
3. **EXCLUDE** - View dimensions MINUS specified

---

### **1. FIXED LOD** ‚≠ê‚≠ê‚≠ê **MOST COMMON**

**Syntax:**
```
{ FIXED [Dimension1], [Dimension2], ... : Aggregation }
```

**What it does:**
- Calculates at **exact dimensions specified**
- **Ignores** view dimensions
- Independent of viz level of detail

---

**Example 1: Sales per Customer**

**Regular approach (FAILS):**
```
SUM([Sales]) / COUNTD([Customer ID])
```
**Problem:** Depends on view granularity!

**LOD approach (WORKS):**
```
{ FIXED [Customer ID] : SUM([Sales]) }
```
**Result:** Each customer's total sales, usable at ANY level

---

**Visual Example:**

**Data:**
```
Customer | Product | Sales
Alice    | Chair   | 100
Alice    | Desk    | 200
Bob      | Chair   | 150
Bob      | Lamp    | 50
```

**FIXED calculation:**
```
{ FIXED [Customer ID] : SUM([Sales]) }
```

**Calculates:**
```
Alice: 300 (100+200)
Bob: 200 (150+50)
```

**Now in ANY view:**
- Product view: Shows customer totals per product
- Region view: Shows customer totals per region
- Summary view: Can average customer values

---

**Example 2: Average Order Value**

```
{ FIXED [Order ID] : SUM([Sales]) }
```

Then in view:
```
AVG([Customer Sales LOD])
```

**Result:** Average sales per order, regardless of view detail

---

**Example 3: Customer Cohort (First Purchase Date)**

```
{ FIXED [Customer ID] : MIN([Order Date]) }
```

**Result:** Each customer's first order date
**Use:** Cohort analysis, customer lifetime value

---

### **FIXED with Multiple Dimensions**

**Can specify multiple dimensions:**

```
{ FIXED [Customer ID], [Region] : SUM([Sales]) }
```

**Calculates:** Sales per Customer-Region combination

---

**Grand Total (No dimensions):**

```
{ FIXED : SUM([Sales]) }
```

**No dimensions = entire dataset!**
**Result:** Grand total, available at any level

**Use case:** Percent of grand total
```
SUM([Sales]) / { FIXED : SUM([Sales]) }
```

---

### **2. INCLUDE LOD** ‚≠ê‚≠ê

**Syntax:**
```
{ INCLUDE [Dimension] : Aggregation }
```

**What it does:**
- Calculates at **view dimensions PLUS specified dimension**
- Adds more detail than view shows
- Then aggregated back to view level

---

**Example: Average Sales per Customer (within product view)**

**View:** Product on Rows, Sales on Rows

**Without LOD:**
```
SUM([Sales])
```
Shows: Total sales per product (all customers aggregated)

**With INCLUDE LOD:**
```
{ INCLUDE [Customer ID] : SUM([Sales]) }
```

**Process:**
1. Calculate sales per Product-Customer combination
2. Aggregate back to Product level (AVG by default)
3. Shows: Average customer's sales within each product

---

**Visual Example:**

**Data:**
```
Product | Customer | Sales
Chair   | Alice    | 100
Chair   | Bob      | 150
Chair   | Carol    | 200
Desk    | Alice    | 300
Desk    | Bob      | 250
```

**View:** Product (just Product dimension)

**Regular SUM([Sales]):**
```
Chair: 450
Desk: 550
```

**INCLUDE [Customer ID]:**
```
{ INCLUDE [Customer ID] : SUM([Sales]) }
```

**Step 1:** Calculate per Product-Customer
```
Chair-Alice: 100
Chair-Bob: 150
Chair-Carol: 200
Desk-Alice: 300
Desk-Bob: 250
```

**Step 2:** Aggregate back to Product (AVG)
```
Chair: 150  (avg of 100, 150, 200)
Desk: 275   (avg of 300, 250)
```

---

**Why useful?**
Shows "typical customer experience" within each product, not just totals!

---

### **3. EXCLUDE LOD** ‚≠ê

**Syntax:**
```
{ EXCLUDE [Dimension] : Aggregation }
```

**What it does:**
- Calculates at **view dimensions MINUS specified dimension**
- Removes detail from view
- Aggregates at coarser level

---

**Example: Category Sales (excluding Product detail)**

**View:** Product on Rows, Category on Rows (hierarchy)

**With EXCLUDE:**
```
{ EXCLUDE [Product] : SUM([Sales]) }
```

**Result:** Shows category total for each product row
**Use:** Compare each product to its category total

---

**Visual Example:**

**Data:**
```
Category   | Product   | Sales
Furniture  | Chair     | 100
Furniture  | Desk      | 200
Furniture  | Table     | 150
Technology | Laptop    | 500
Technology | Monitor   | 300
```

**View:** Category, Product (both on Rows)

**Regular SUM([Sales]):**
```
Furniture - Chair:   100
Furniture - Desk:    200
Furniture - Table:   150
Technology - Laptop: 500
Technology - Monitor: 300
```

**EXCLUDE [Product]:**
```
{ EXCLUDE [Product] : SUM([Sales]) }
```

**Result:**
```
Furniture - Chair:   450  (category total)
Furniture - Desk:    450  (category total)
Furniture - Table:   450  (category total)
Technology - Laptop: 800  (category total)
Technology - Monitor: 800  (category total)
```

---

**Use with calculation:**

**Percent of Category:**
```
SUM([Sales]) / { EXCLUDE [Product] : SUM([Sales]) }
```

**Result:**
```
Furniture - Chair:   22.2%  (100/450)
Furniture - Desk:    44.4%  (200/450)
Furniture - Table:   33.3%  (150/450)
Technology - Laptop: 62.5%  (500/800)
Technology - Monitor: 37.5%  (300/800)
```

---

### **LOD vs Aggregation vs Table Calculations** ‚≠ê‚≠ê‚≠ê **CRITICAL!**

**Comparison table:**

| Feature | Regular Agg | Table Calc | LOD |
|---------|-------------|------------|-----|
| **Calculation timing** | Part of query | After query | Part of query |
| **Depends on view?** | Yes | Yes | FIXED: No, INCLUDE/EXCLUDE: Yes |
| **Affected by dimension filters?** | Yes | Yes | FIXED: No* |
| **Affected by measure filters?** | Yes | No | Yes |
| **Can change granularity?** | No | No | Yes |
| **Performance** | Fast | Medium | Fast |

*FIXED ignores dimension filters except context filters

---

### **When to Use Each:**

**Use Regular Aggregation when:**
- Simple sum/average at view level
- No special granularity needed

**Use Table Calculation when:**
- Need running totals, ranks
- Comparing to previous values
- Operating on values in table

**Use LOD when:**
- Need different granularity than view
- Customer-level metric in product view
- Calculations independent of view
- Complex ratio scenarios

---

### **LOD Expression Examples**

**1. Customer Lifetime Value**

```
{ FIXED [Customer ID] : SUM([Profit]) }
```

Then in view showing regions:
```
AVG([Customer LTV])
```
Shows average customer value per region

---

**2. Repeat Purchase Rate**

**Orders per customer:**
```
{ FIXED [Customer ID] : COUNTD([Order ID]) }
```

**Percent who ordered 2+:**
```
SUM(
  IF { FIXED [Customer ID] : COUNTD([Order ID]) } > 1 
  THEN 1 ELSE 0 END
) / COUNTD([Customer ID])
```

---

**3. Market Basket Analysis**

**Products per order:**
```
{ FIXED [Order ID] : COUNTD([Product ID]) }
```

**Average basket size:**
```
AVG([Products per Order])
```

---

**4. New vs Returning Customers**

**First order date:**
```
{ FIXED [Customer ID] : MIN([Order Date]) }
```

**Is this first order?**
```
IF [Order Date] = [First Order Date] 
THEN "New" 
ELSE "Returning" 
END
```

---

**5. Customer Acquisition Cohort**

**Cohort (year of first purchase):**
```
YEAR({ FIXED [Customer ID] : MIN([Order Date]) })
```

**Cohort analysis:** Track customer behavior by acquisition year

---

**6. Same Store Sales**

**Stores that existed last year:**
```
{ FIXED [Store ID] : MIN([Open Date]) } < DATEADD('year', -1, TODAY())
```

**Filter to these stores, compare YoY:**
Eliminates new store growth, shows organic growth

---

**7. Top Products by Region**

**Product rank within region:**
```
{ FIXED [Region], [Product] : SUM([Sales]) }
```

Then use with IF:
```
IF RANK({ FIXED [Region], [Product] : SUM([Sales]) }) <= 5
THEN [Product] 
ELSE "Other" 
END
```

---

**8. Percent of Grand Total (LOD way)**

```
SUM([Sales]) / { FIXED : SUM([Sales]) }
```

Alternative to table calculation!
**Advantage:** Not affected by filters (if FIXED)

---

**9. Average Order Value by Customer Segment**

**Order value:**
```
{ FIXED [Order ID] : SUM([Sales]) }
```

**Customer segment (by total spend):**
```
IF { FIXED [Customer ID] : SUM([Sales]) } > 10000 
THEN "VIP"
ELSEIF { FIXED [Customer ID] : SUM([Sales]) } > 5000 
THEN "Premium"
ELSE "Standard"
END
```

**Then view:** AVG(Order Value) by Segment

---

**10. Category Concentration (Herfindahl Index)**

**Each product's squared market share:**
```
SQUARE(
  SUM([Sales]) / { EXCLUDE [Product] : SUM([Sales]) }
)
```

**Sum at category level:** Shows concentration (1 = monopoly, close to 0 = fragmented)

---

### **LOD Expression Best Practices**

‚úÖ **DO:**
- Use FIXED for customer/order level metrics
- Use INCLUDE for "per item" averages
- Use EXCLUDE for subtotals in detail views
- Name LOD calcs clearly (e.g., "Customer Total Sales")
- Test with simple data first

‚ùå **DON'T:**
- Nest LOD expressions excessively (performance!)
- Use LOD when regular agg works fine
- Mix LOD with table calcs without understanding
- Forget to aggregate LOD result in view

---

### **LOD and Filters - Order of Operations** ‚≠ê **CRITICAL!**

**Filter Order:**
1. Extract Filters
2. Data Source Filters
3. Context Filters
4. **FIXED LOD** ‚Üê Calculates here
5. Dimension Filters
6. **INCLUDE/EXCLUDE LOD** ‚Üê Calculates here
7. Measure Filters
8. Table Calc Filters

**Key insights:**

**FIXED LOD:**
- Ignores dimension filters
- Affected by context filters
- Use when you want calculation independent of user filters

**INCLUDE/EXCLUDE LOD:**
- Affected by dimension filters
- Behaves more like regular aggregation
- Use when you want filter-aware calculations

---

**Example - Context Filters with LOD:**

**Problem:** LOD ignoring filter you want it to respect

**Solution:** Make filter a Context Filter
1. Right-click filter ‚Üí **Add to Context**
2. Now FIXED LOD respects this filter

**Use case:** Regional dashboard where FIXED should calculate within selected region only

---

### **Advanced LOD Techniques**

**1. Nested LOD (Use sparingly!)**

```
{ FIXED [Category] : 
  AVG({ FIXED [Customer ID] : SUM([Sales]) })
}
```

**Reads:** For each category, what's the average customer's total sales?

**Process:**
1. Inner: Customer total sales
2. Outer: Average by category

**‚ö†Ô∏è Warning:** Complex, slow, hard to debug

---

**2. LOD in Calculated Fields**

**Can use LOD inside IF statements:**

```
IF { FIXED [Customer ID] : COUNTD([Order ID]) } > 5 
THEN "Loyal"
ELSE "Casual"
END
```

---

**3. LOD with Date Functions**

**Customer tenure in days:**
```
DATEDIFF('day', 
  { FIXED [Customer ID] : MIN([Order Date]) },
  TODAY()
)
```

---

**4. LOD for Data Quality Checks**

**Orders with multiple ship dates (data error):**
```
{ FIXED [Order ID] : COUNTD([Ship Date]) } > 1
```

Filter to `TRUE` to find problematic orders

---

**5. LOD for Blending Alternative**

**Instead of data blending, use LOD:**

**Budget (separate table):**
```
{ FIXED [Category] : MAX([Budget]) }
```

Brings budget into transaction-level data without blending!

---

### **Common LOD Errors and Fixes**

**Error: "Cannot mix aggregate and non-aggregate"**

‚ùå **Wrong:**
```
{ FIXED [Customer ID] : [Sales] }
```

‚úÖ **Correct:**
```
{ FIXED [Customer ID] : SUM([Sales]) }
```

**Must aggregate inside LOD!**

---

**Error: "Cannot use table calculation inside LOD"**

‚ùå **Wrong:**
```
{ FIXED [Product] : RANK(SUM([Sales])) }
```

**Table calcs can't go inside LOD expressions**

---

**Error: "Unexpected results with filters"**

**Issue:** FIXED ignoring dimension filter

**Fix:** 
- Use INCLUDE/EXCLUDE instead, OR
- Add filter to Context

---

**Error: "Performance very slow"**

**Issue:** Nested LOD or complex LOD

**Fix:**
- Simplify expression
- Break into multiple calcs
- Consider data prep instead
- Use data extract

---

### **LOD vs SQL**

**For SQL users, LOD is like:**

**FIXED = Subquery with GROUP BY**
```sql
-- LOD: { FIXED [Customer ID] : SUM([Sales]) }
SELECT Customer_ID, SUM(Sales)
FROM Orders
GROUP BY Customer_ID
```

**INCLUDE = JOIN to aggregated subquery**

**EXCLUDE = Window function with different partition**

---

### **Scenario-Based Questions:**

**Q1:** Calculate average sales per customer, displayed at product level. Which LOD?
- A) `{ FIXED [Product] : AVG([Sales]) }`
- B) `{ FIXED [Customer ID] : SUM([Sales]) }` then AVG in view ‚úÖ
- C) `{ INCLUDE [Customer ID] : SUM([Sales]) }`
- D) `AVG(SUM([Sales]))`

**Why?** Need customer-level totals (FIXED by Customer), then average those at product level.

---

**Q2:** View shows products. You want each product's % of its category total. Which LOD?
- A) `{ FIXED [Category] : SUM([Sales]) }` ‚úÖ then divide
- B) `{ INCLUDE [Category] : SUM([Sales]) }`
- C) `{ EXCLUDE [Product] : SUM([Sales]) }` ‚úÖ then divide
- D) Table calculation

**Why?** Both A and C work! FIXED at category level, or EXCLUDE product from view. Then: `SUM([Sales]) / [LOD]`

---

**Q3:** You want calculation to ignore user's region filter. Which LOD type?
- A) Regular aggregation
- B) FIXED ‚úÖ
- C) INCLUDE
- D) EXCLUDE

**Why?** FIXED calculates before dimension filters, so ignores user selections (unless context filter).

---

**Q4:** This LOD errors: `{ FIXED [Customer] : [Sales] }`. Fix?
- A) Remove FIXED keyword
- B) Add aggregation: `{ FIXED [Customer] : SUM([Sales]) }` ‚úÖ
- C) Change to INCLUDE
- D) Add brackets

**Why?** Must aggregate inside LOD expression. Can't reference raw field directly.

---

**Q5:** When do FIXED and regular aggregation give same result?
- A) Never
- B) Always
- C) When view dimension matches FIXED dimension ‚úÖ
- D) Only with SUM

**Why?** If view shows customers and you FIXED by customer, both calculate at customer level. But FIXED stays same if you change view!

---

## **Topic 28: Context & Dimension Filters**

### **Understanding Filter Order of Operations** ‚≠ê‚≠ê‚≠ê

**The complete order Tableau processes filters:**

```
1. Extract Filters (if using extract)
2. Data Source Filters
3. Context Filters ‚Üê Special!
4. FIXED LOD Expressions
5. Dimension Filters (Top N, conditional, general)
6. INCLUDE/EXCLUDE LOD Expressions
7. Measure Filters
8. Table Calculation Filters
9. Trend Lines & Reference Lines
```

**This order is CRITICAL for understanding Tableau behavior!**

---

### **Context Filters** ‚≠ê‚≠ê

**What is a Context Filter?**

A **dimension filter promoted** to execute earlier in filter order.

**Normal dimension filter:**
- Applied at step 5
- After FIXED LOD
- Independent of other dimension filters

**Context filter:**
- Applied at step 3
- Before FIXED LOD
- Creates "context" for other filters

---

### **Why Use Context Filters?**

**Problem 1: Top N doesn't work as expected**

**Scenario:**
- Filter to "West" region
- Then filter to "Top 10 Products"

**Without context:**
1. Calculate Top 10 across ALL data
2. Then filter to West
3. Result: May show fewer than 10 products!

**With context (West region):**
1. Filter to West first
2. Calculate Top 10 within West
3. Result: Exactly top 10 West products

---

**Problem 2: FIXED LOD needs to respect filter**

**Scenario:**
```
{ FIXED [Customer] : SUM([Sales]) }
```
User filters to 2023, but FIXED ignores it (includes all years)

**Solution:** Make year filter a Context Filter
- Now FIXED calculates within 2023 only

---

**Problem 3: Performance with large datasets**

**Context filters:**
- Create temporary subset
- Other filters operate on subset (faster)
- Like pre-filtering data

---

### **Creating Context Filters**

**Method 1: From existing filter**
1. Add regular filter to view
2. Right-click filter ‚Üí **Add to Context**
3. Filter turns gray (visual indicator)

**Method 2: Add as context directly**
1. Drag dimension to Filters
2. Before closing dialog, check **Add to context**

**Multiple context filters:**
- Can have many
- All applied together at step 3
- Combined with AND logic

---

### **Context Filter Indicators**

**Visual cues:**

**Regular filter:** White/gray pill
**Context filter:** Gray pill with darker border

**Filter order shown in Filters shelf:**
- Context filters appear at top
- Separated by line from regular filters

---

### **Context Filter Examples**

**Example 1: Top N by Category**

**Setup:**
1. Category filter (Add to Context)
2. Top 10 Products filter (regular)

**Result:** Top 10 products within selected category

---

**Example 2: Regional Dashboard**

**Setup:**
1. Region parameter ‚Üí Region filter (Add to Context)
2. All LOD expressions now calculate within selected region
3. Performance improved (smaller dataset)

---

**Example 3: Date Range for All Calculations**

**Setup:**
1. Date range filter (Add to Context)
2. All calculations, including FIXED LOD, respect date range
3. Consistent time period across entire dashboard

---

### **Context Filters Best Practices**

‚úÖ **Good uses:**
- Top N filters (especially with other filters)
- LOD expressions need to respect filter
- Performance optimization
- Regional/business unit scoping

‚ùå **Don't overuse:**
- Makes query slower (creates temp table)
- Only use when necessary
- Not needed if no dependent filters/LODs

---

### **Dimension Filters Deep Dive**

**Already covered basics in Module 3; now advanced concepts:**

---

### **Top N Filters** ‚≠ê

**Two ways to create:**

**Method 1: Filter Dialog - Top Tab**
1. Drag dimension to Filters
2. Click **Top** tab
3. Configure:
   - By field: Which measure
   - Top/Bottom
   - Number to show

**Method 2: Set + Filter**
1. Create dynamic set with Top N condition
2. Drag set to Filters
3. Select "In"

---

**Top N with Multiple Dimensions:**

**Scenario:** Top 5 products per category

**Approach 1: Context Filter**
1. Category ‚Üí Filter (Add to Context)
2. Product ‚Üí Filter (Top 5 by Sales)

**Approach 2: LOD + Rank**
```
RANK({ FIXED [Category], [Product] : SUM([Sales]) })
```
Filter: Rank <= 5
Compute Using: Partitioning by Category

---

### **Conditional Filters**

**Filter based on calculated logic:**

**Example: High Value Customers**

**Condition Tab:**
```
SUM([Sales]) > 10000
```

Only shows customers exceeding $10K sales

**Example: Products Sold This Year**

**Condition:**
```
MAX([Order Date]) >= DATETRUNC('year', TODAY())
```

Only shows products with sales in current year

---

### **Wildcard Filters**

**Pattern matching for text:**

**Contains:**
```
[Product Name] contains "Pro"
```
Matches: "iPhone Pro", "MacBook Pro", "Pro Display"

**Starts with:**
```
[Order ID] starts with "2023"
```
All 2023 orders

**Ends with:**
```
[Customer Email] ends with ".edu"
```
Educational customers

**Exact match:**
```
[Category] exactly matches "Furniture"
```
Case-sensitive exact match

---

### **Filter Actions from Dashboards**

**Filters can come from actions (Topic 23):**
- User clicks mark
- Filters other sheets
- Dynamic interaction

**Relation to filter order:**
- Action filters are regular dimension filters
- Applied at step 5
- Can make context filters if needed

---

### **Cascading Filters**

**Filters that depend on other filters:**

**Example: Country ‚Üí State ‚Üí City**

**Setup:**
1. Country filter (affects State list)
2. State filter ‚Üí "Only Relevant Values" checked
3. City filter ‚Üí "Only Relevant Values" checked

**Result:** Selecting country limits states shown, selecting state limits cities

**"Only Relevant Values":**
- Right-click filter ‚Üí Edit
- Check "Only relevant values"
- Filter shows only values that exist with other filters applied

---

### **All/None Shortcuts**

**Multi-select filters:**

**Show "All" value:**
- Right-click filter ‚Üí Customize
- Check "Show 'All' value"
- Single click selects/deselects everything

**Useful for:**
- Quick reset
- User convenience
- Dashboard controls

---

### **Apply Button**

**Delayed filter application:**

**Default:** Filters apply immediately (fast but many queries)

**With Apply button:**
1. Right-click filter ‚Üí Customize
2. Check "Show Apply button"
3. Users select values, then click Apply

**Advantages:**
- Batch multiple selections
- Reduces query count
- Better for large datasets

**Disadvantages:**
- Extra click required
- Less immediate feedback

---

### **Filter Hierarchies**

**Using hierarchies in filters:**

**Example: Date hierarchy (Year ‚Üí Quarter ‚Üí Month)**

**User experience:**
1. Select Year ‚Üí Shows quarters
2. Select Quarter ‚Üí Shows months
3. Select Month ‚Üí Specific month

**Alternative:** Parameters with dependent filters

---

### **Relative Date Filters** (Revisited)

**Dynamic date ranges:**

**Last N days/weeks/months:**
- Always current
- Rolls forward daily
- Perfect for "Last 30 Days" dashboards

**Anchor options:**
- **Anchor to:** TODAY, specific date, parameter
- Allows custom reference points

---

### **Filter Performance Tips**

**Slow filters? Try this:**

‚úÖ **Use extracts instead of live**
- Filters much faster on extracts

‚úÖ **Context filters for large datasets**
- Reduces data for subsequent filters

‚úÖ **Limit filter options**
- Show Top 100 instead of all values
- "Only relevant values" reduces list

‚úÖ **Single value filters**
- Radio buttons faster than checkboxes

‚úÖ **Use parameters instead**
- Parameters don't query database
- Control what users can select

---

### **Filters vs Parameters**

**When to use each:**

**Filters:**
- User selects from data
- Values update with data
- Can multi-select
- Slower (queries database)

**Parameters:**
- Fixed list of values
- Values don't change
- Single value only (usually)
- Faster (no query)

**Combined approach:**
- Parameter controls logic
- Filter applies within logic
- Best of both!

---

### **Scenario-Based Questions:**

**Q1:** User filters to "East" region, then "Top 10 Products" but only 6 show. Why?
- A) Data error
- B) Top 10 calculated before region filter, then only 6 exist in East ‚úÖ
- C) Wrong filter type
- D) Need measure filter

**Why?** Without context filter, Top 10 calculated across all regions first. Solution: Make region filter a context filter.

---

**Q2:** FIXED LOD should respect user's year filter but doesn't. Fix?
- A) Change to INCLUDE
- B) Make year filter a context filter ‚úÖ
- C) Use table calculation instead
- D) Can't be done

**Why?** FIXED calculates before dimension filters. Context filters execute before FIXED, so FIXED respects them.

---

**Q3:** Filter showing all 10,000 customers is very slow. Best fix?
- A) Use parameter instead ‚úÖ (if limited list OK)
- B) Remove filter
- C) Use action filter
- D) Add more memory

**Why?** Parameters don't query database for values, much faster. Or use conditional filter with search, or limit to recent customers.

---

**Q4:** You want "Country ‚Üí State ‚Üí City" cascading filters. What setting?
- A) Add to Context
- B) "Only relevant values" ‚úÖ
- C) Relative filters
- D) Wildcard match

**Why?** "Only relevant values" shows only states in selected country, cities in selected state.

---

## **MODULE 7 SUMMARY**

### **Key Takeaways:**

‚úÖ **Table Calculations** - Operate on values in the view
  - Running totals, ranks, moving averages
  - "Compute Using" controls direction
  - Addressing and partitioning

‚úÖ **Quick Table Calculations** - Built-in shortcuts
  - Percent of Total, Difference, Rank
  - YoY Growth, Moving Average, YTD

‚úÖ **LOD Expressions** - Control aggregation level
  - FIXED: Specific dimensions, ignore view
  - INCLUDE: Add dimensions to view
  - EXCLUDE: Remove dimensions from view

‚úÖ **Context Filters** - Execute early
  - Before FIXED LOD
  - Enable Top N to work correctly
  - Performance optimization

‚úÖ **Filter Order** - Critical for understanding
  - Extract ‚Üí Data Source ‚Üí Context ‚Üí FIXED ‚Üí Dimension ‚Üí INCLUDE/EXCLUDE ‚Üí Measure ‚Üí Table Calc

---

### **Most Important Exam Concepts** üéØ

1. **Compute Using direction** - Most common table calc question
2. **FIXED vs INCLUDE vs EXCLUDE** - When to use each
3. **Filter order of operations** - Why calculations behave certain ways
4. **Context filters** - Solving Top N problems
5. **LOD with filters** - FIXED ignores dimension filters

---

### **Common Mistakes to Avoid** ‚ùå

1. Wrong "Compute Using" direction
2. Forgetting to aggregate inside LOD
3. Not understanding filter order
4. Using table calc when LOD better (or vice versa)
5. Nested LOD expressions (performance killer)
6. Not making filter context when needed for Top N

---

**Ready for Module 8: Advanced Topics?** üöÄ

Module 8 covers:
- Joining & Blending Data
- Data Preparation & Cleaning
- Performance Optimization
- Best Practices & Exam Strategies

This is the final module before you're exam-ready!

Type **"Module 8"** when ready to continue, or let me know if you want to:
- Review any LOD concepts
- See more practice problems
- Work through specific scenarios

Module 7 is the most advanced - make sure you're comfortable before moving on! üí™
